<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<!-- 文章内容 -->
<div
        th:fragment="comment_list(comments, article)"
        class="comment-list-wrap"
        id="commentList"
>
    <!-- 评论textarea -->
    <div class="comment-write-wrap">
        <img
                th:if="${global.isLogin}"
                th:alt="${global.user.userName}"
                th:src="${global.user.photo}"
                class="comment-write-img"
        />
        <!-- <div th:if="${!global.isLogin}"></div> -->
        <div class="common-write-content">
        <textarea
                th:data-target="${global.isLogin ? '' : '#loginModal'}"
                th:data-toggle="${global.isLogin ? '' : 'modal'}"
                th:placeholder="${global.isLogin ? '输入评论...' : '请先登录后再评论'}"
                class="comment-write-textarea"
                id="commentContent"
                maxlength="512"
        ></textarea>
            <button
                    id="commentBtn"
                    type="button"
                    class="comment-write-btn"
                    disabled
            >
                评论
            </button>
        </div>
    </div>

    <!-- 评论列表 -->
    <div th:class="${(#lists.isEmpty(comments) ? ' no-comment-box' : '')}">
        <!-- 暂无评论 -->
        <div
                th:if="${#lists.isEmpty(comments)}"
                th:include="plugins/custom-empty :: custom-empty('暂无评论')"
        ></div>

        <!-- 列表 -->
        <div th:each="comment : ${comments}" class="comment-list-wrap">
            <div class="comment-item-wrap">
                <a th:href="${'/user/' + comment.userId}" target="_blank">
                    <img
                            th:alt="${comment.userName}"
                            th:src="${comment.userPhoto}"
                            class="comment-item-img"
                    />
                </a>
                <div class="common-item-content">
                    <div class="common-item-content-head">
              <span
                      th:text="${comment.userName} + ${comment.userId == article.author ? '（作者）': ''}"
              >
                作者
              </span>
                        <span
                                th:text="${T(com.github.liuyueyi.forum.core.util.DateUtil).time2day(comment.commentTime)}"
                        >
                时间
              </span>
                    </div>
                    <div
                            class="common-item-content-value"
                            th:text="${comment.commentContent}"
                    >
                        内容
                    </div>
                    <div>
                        <small
                                th:data-target="${global.isLogin ? '#commentModal' : '#loginModal'}"
                                data-toggle="modal"
                                th:data-reply-top="${comment.commentId}"
                                th:data-reply-id="${comment.commentId}"
                                th:data-reply-nickname="${comment.userName}"
                                th:data-reply-content="${comment.commentContent}"
                                class="reply-comment"
                        >
                            <i data-feather="message-circle"></i>
                            回复
                        </small>
                    </div>
                </div>
            </div>

            <!-- 二级评论 -->
            <div th:if="${!#lists.isEmpty(comment.childComments)}"
                 th:each="reply : ${comment.childComments}"
                 class="comment-item-wrap-second">
                <a th:href="${'/user/' + comment.userId}" target="_blank">
                    <img
                            th:alt="${comment.userName}"
                            th:src="${comment.userPhoto}"
                            class="comment-item-img"
                    />
                </a>
                <div class="common-item-content">
                    <div class="common-item-content-head">
                          <span>
                            <a th:text="${comment.userName} + ${comment.userId == article.author ? '（作者）': ''}"
                               th:href="${'/user/' + reply.userId}" target="_blank"></a>
                          </span>
                        <span th:text="${T(com.github.liuyueyi.forum.core.util.DateUtil).time2day(reply.commentTime)}">
                        回复时间
                      </span>
                    </div>
                    <div class="common-item-content-value" th:text="${reply.commentContent}">
                        回复内容
                    </div>
                    <small th:if="${!#strings.isEmpty(reply.parentContent)}"
                           style=" display: flex;    background: #f2f3f5;    border: 1px solid #e4e6eb;    box-sizing: border-box;    border-radius: 4px;    padding: 0 12px;    line-height: 36px;    height: 36px;    font-size: 14px;    color: #8a919f;    margin-top: 8px;">
                        <span th:text="${reply.parentContent}"> 回复的引用 </span>
                    </small>
                    <div>
                        <small
                                th:data-target="${global.isLogin ? '#commentModal' : '#loginModal'}"
                                data-toggle="modal"
                                th:data-reply-top="${comment.commentId}"
                                th:data-reply-id="${reply.commentId}"
                                th:data-reply-nickname="${reply.userName}"
                                th:data-reply-content="${reply.commentContent}"
                                class="reply-comment"
                        >
                            <i data-feather="message-circle"></i>
                            回复
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 二级评论 Modal -->
    <div
            class="modal fade"
            id="commentModal"
            data-backdrop="static"
            data-keyboard="false"
            tabindex="-1"
            role="dialog"
            aria-labelledby="commentModalDropLabel"
            aria-hidden="true"
    >
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="commentModalDropLabel">回复</h5>
                    <button
                            type="button"
                            class="close"
                            data-dismiss="modal"
                            aria-label="Close"
                    >
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="repliedContent" class="comment-content-box-content"></p>
                    <div class="input-group">
              <textarea
                      id="replyContent"
                      placeholder="请输入回复内容"
                      class="posts-comment-input-box-textarea"
              ></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button
                            id="replyBtn"
                            data-reply-id=""
                            type="button"
                            class="btn btn-primary"
                    >
                        回复
                    </button>
                    <button
                            type="button"
                            class="btn btn-secondary"
                            data-dismiss="modal"
                    >
                        取消
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
</html>
